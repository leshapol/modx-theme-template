[[!If? &subject=`[[++analytics]]` &operator=`notempty` &then=`
<script>
  (function () {
    var id = "[[++analytics]]";
    var type = "[[++anatag]]";
    var isLazy = "[[++analytics_lazy]]" === "1";
    var loaded = false;

    function loadGTM() {
      if (loaded) return;
      loaded = true;
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
      var f = document.getElementsByTagName("script")[0];
      var j = document.createElement("script");
      j.async = true;
      j.src = "https://www.googletagmanager.com/gtm.js?id=" + id;
      f.parentNode.insertBefore(j, f);
    }

    function loadGtag() {
      if (loaded) return;
      loaded = true;
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({ event: "gtag.init", "gtm.start": new Date().getTime() });
      var s = document.createElement("script");
      s.async = true;
      s.src = "https://www.googletagmanager.com/gtag/js?id=" + id;
      s.onload = function () {
        window.gtag = window.gtag || function () {
          dataLayer.push(arguments);
        };
        gtag("js", new Date());
        gtag("config", id);
      };
      document.head.appendChild(s);
    }

    var loader = type === "tagmanager" ? loadGTM : loadGtag;

    if (!isLazy) {
      loader();
      return;
    }

    var fired = false;
    var events = ["scroll", "mousemove", "touchstart", "keydown"];

    function triggerLoad() {
      if (fired) return;
      fired = true;
      cleanup();
      loader();
    }

    function cleanup() {
      events.forEach(function (evt) {
        window.removeEventListener(evt, triggerLoad, passiveOpts);
      });
    }

    var passiveOpts = { passive: true };
    events.forEach(function (evt) {
      window.addEventListener(evt, triggerLoad, passiveOpts);
    });
  })();
</script>
[[++conversion-snippet]]
`]]
